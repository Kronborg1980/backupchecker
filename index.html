<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kronborg's Stealth Checker v3.0 (2026 Edition)</title>
  <style>
    /* TRON / CYBERPUNK THEME - v3.0 */
    .bg-black { background-color: #050505; }
    .text-neon-cyan { color: #00f3ff; }
    .text-neon-red { color: #ff003c; }
    .text-neon-green { color: #0aff48; }
    .text-neon-yellow { color: #fcee0a; }
    .text-white-glow { color: #ffffff; text-shadow: 0 0 8px rgba(255, 255, 255, 0.5); }
    
    body {
      font-family: 'Orbitron', monospace;
      background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #000000 100%);
      color: #00f3ff;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #00f3ff #000000;
    }

    /* Grid Animation */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; width: 200%; height: 200%;
      background: 
        linear-gradient(rgba(0, 243, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.1) 1px, transparent 1px);
      background-size: 40px 40px;
      transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
      animation: gridScroll 20s linear infinite;
      z-index: -1;
      pointer-events: none;
    }
    @keyframes gridScroll {
      0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); }
      100% { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); }
    }

    .glass-panel {
      background: rgba(10, 10, 10, 0.85);
      border: 1px solid rgba(0, 243, 255, 0.3);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 20px rgba(0, 243, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 500px;
      width: 95%;
      margin: 2rem auto;
      position: relative;
    }

    h1 { text-shadow: 0 0 10px #00f3ff; text-transform: uppercase; letter-spacing: 2px; text-align: center; margin-bottom: 0.5rem; }
    .sub-text { text-align: center; color: #8899a6; font-size: 0.8rem; margin-bottom: 1.5rem; }

    input, button, select {
      font-family: 'Orbitron', monospace;
      outline: none;
    }

    input[type="email"], input[type="url"] {
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid #00f3ff;
      color: #fff;
      padding: 10px;
      border-radius: 4px;
      transition: 0.3s;
    }
    input:focus { box-shadow: 0 0 15px rgba(0, 243, 255, 0.4); }

    button {
      cursor: pointer;
      font-weight: bold;
      text-transform: uppercase;
      transition: all 0.2s;
    }
    
    .btn-main {
      width: 100%;
      padding: 12px;
      border: 1px solid #00f3ff;
      background: rgba(0, 243, 255, 0.1);
      color: #00f3ff;
      margin-top: 10px;
      border-radius: 4px;
    }
    .btn-main:hover { background: rgba(0, 243, 255, 0.3); box-shadow: 0 0 15px #00f3ff; }

    .btn-stop {
      border-color: #ff003c;
      color: #ff003c;
      background: rgba(255, 0, 60, 0.1);
    }
    .btn-stop:hover { background: rgba(255, 0, 60, 0.3); box-shadow: 0 0 15px #ff003c; }

    .btn-secondary {
      padding: 5px 10px;
      border: 1px solid #0aff48;
      color: #0aff48;
      background: transparent;
      border-radius: 4px;
      font-size: 0.8rem;
    }
    .btn-secondary:hover { background: rgba(10, 255, 72, 0.2); }

    .status-panel {
      background: rgba(0,0,0,0.5);
      border: 1px solid #333;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
    }
    
    .hidden { display: none; }
    .flex { display: flex; align-items: center; gap: 10px; }
    .mb-2 { margin-bottom: 10px; }
    .mt-2 { margin-top: 10px; }
    
    /* Range Slider */
    input[type=range] { width: 100%; accent-color: #00f3ff; }

    /* Animations */
    @keyframes pulse-red { 0% { text-shadow: 0 0 5px #ff003c; } 100% { text-shadow: 0 0 20px #ff003c; } }
    .alert-active { animation: pulse-red 1s infinite alternate; }

    /* Webhook Special */
    .pokezonan-btn {
      background: linear-gradient(90deg, #ff003c, #00f3ff);
      border: none;
      color: white;
      padding: 8px;
      border-radius: 4px;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body class="bg-black">

  <div class="glass-panel">
    <h1>Kronborg's Checker v3.0</h1>
    <p class="sub-text">Stealth Mode: ENABLED. Target: TCG Category</p>

    <div id="setupArea">
      
      <div class="mb-2">
        <label class="text-neon-cyan text-sm">Alert Emails:</label>
        <div id="emailContainer">
          <div class="flex mb-2">
            <input type="email" class="email-input" placeholder="you@example.com">
          </div>
        </div>
        <button onclick="addEmailField()" class="btn-secondary" style="width:100%">+ Add Email</button>
      </div>

      <div class="mb-2 mt-2">
        <label class="text-neon-cyan text-sm">Discord Webhook:</label>
        <div class="flex">
          <input type="url" id="webhookInput" placeholder="https://discord.com/api/webhooks/...">
          <button onclick="fillPokezonan()" class="pokezonan-btn" title="Auto-fill Pokezonan">‚ö°</button>
        </div>
      </div>

      <div class="mt-2">
        <label class="text-neon-cyan text-sm">
           Check Frequency: <span id="freqLabel" class="text-white-glow">10</span> min (+ Random Jitter)
        </label>
        <input type="range" id="freqSlider" min="2" max="60" value="10" oninput="updateFreq(this.value)">
      </div>

      <div class="flex mt-2" style="justify-content: space-between;">
        <button id="toggleEmail" class="btn-secondary" onclick="toggleAlerts('email')">Email: ON</button>
        <button id="toggleDiscord" class="btn-secondary" onclick="toggleAlerts('discord')">Discord: ON</button>
        <button class="btn-secondary" style="border-color:#fcee0a; color:#fcee0a" onclick="testAlerts()">TEST</button>
      </div>

    </div>

    <div class="status-panel">
      <div style="font-size: 0.8rem; color: #666;">CURRENT STATUS</div>
      <div id="mainStatus" class="text-2xl font-bold text-white-glow" style="margin: 10px 0;">IDLE</div>
      <div id="detailStatus" class="text-sm text-neon-cyan">Waiting to start...</div>
      <div class="mt-2 text-xs text-gray-400">
        Run Time: <span id="timer">00:00:00</span> | Checks: <span id="checkCount">0</span>
      </div>
      <div id="stealthIndicator" class="mt-2 text-xs text-neon-green hidden">üëÅÔ∏è Stealth Proxies Active</div>
    </div>

    <button id="btnStart" class="btn-main" onclick="startSystem()">INITIALIZE SYSTEM</button>
    <button id="btnStop" class="btn-main btn-stop hidden" onclick="stopSystem()">TERMINATE</button>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.4.1/dist/email.min.js"></script>

  <script>
    // --- CONFIGURATION ---
    const EMAILJS_KEY = "8w7eu6mrg3lRl6ta3"; // Your key
    const TARGET_URL = "https://www.pokemoncenter.com/category/trading-card-game";
    
    // State
    let isRunning = false;
    let checkInterval = null;
    let timeInterval = null;
    let startTime = 0;
    let checksPerformed = 0;
    let settings = {
      email: true,
      discord: true,
      baseMinutes: 10
    };

    // Initialize EmailJS
    (function(){
      if(window.emailjs) emailjs.init({ publicKey: EMAILJS_KEY });
    })();

    // --- UI FUNCTIONS ---
    function updateFreq(val) {
      document.getElementById('freqLabel').innerText = val;
      settings.baseMinutes = parseInt(val);
    }

    function addEmailField() {
      const div = document.createElement('div');
      div.className = 'flex mb-2';
      div.innerHTML = `<input type="email" class="email-input" placeholder="another@example.com"><button class="btn-secondary" style="border-color:#ff003c; color:#ff003c" onclick="this.parentElement.remove()">X</button>`;
      document.getElementById('emailContainer').appendChild(div);
    }

    function fillPokezonan() {
      document.getElementById('webhookInput').value = "https://discord.com/api/webhooks/1418654823745716436/vuMKu1s095Cq3BfU06OF_Z_mwxG39zHppHJ3c4BX5X38WuJFWPGhIZdopWTEEXlophiN";
      alert("Pokezonan Secured.");
    }

    function toggleAlerts(type) {
      settings[type] = !settings[type];
      const btn = document.getElementById(type === 'email' ? 'toggleEmail' : 'toggleDiscord');
      btn.innerText = `${type.charAt(0).toUpperCase() + type.slice(1)}: ${settings[type] ? 'ON' : 'OFF'}`;
      btn.style.opacity = settings[type] ? '1' : '0.5';
    }

    // --- LOGIC CORE ---

    function getProxifiedUrls(target) {
        // Advanced 2026 Proxy Rotation
        // We attach random query params to avoid caching
        const timestamp = Date.now();
        const rand = Math.floor(Math.random() * 100000);
        
        // Encode the target URL
        const cleanTarget = encodeURIComponent(target + `?cb=${timestamp}`);

        return [
            `https://api.allorigins.win/raw?url=${cleanTarget}`,
            `https://corsproxy.io/?${cleanTarget}`,
            `https://thingproxy.freeboard.io/fetch/${target}?cb=${timestamp}` // Backup
        ];
    }

    async function checkShop() {
        updateStatus("SCANNING...", "Rotating Proxies...", "text-white-glow");
        
        const proxies = getProxifiedUrls(TARGET_URL);
        let success = false;
        let htmlContent = "";
        let finalUrl = "";

        // Try proxies sequentially
        for (const proxy of proxies) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15s timeout
                
                const response = await fetch(proxy, {
                    method: 'GET',
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (response.ok) {
                    finalUrl = response.url;
                    htmlContent = await response.text();
                    success = true;
                    break; // We got data
                }
            } catch (e) {
                console.log("Proxy failed, switching...");
            }
        }

        checksPerformed++;
        document.getElementById('checkCount').innerText = checksPerformed;

        if (!success) {
            updateStatus("CONNECTION FAILED", "All proxies blocked. Retrying...", "text-neon-red");
            return;
        }

        analyzeResponse(htmlContent, finalUrl);
    }

    function analyzeResponse(html, url) {
        const lowerHtml = html.toLowerCase();
        const lowerUrl = url.toLowerCase();

        // --- DETECTION LOGIC v3.0 ---

        // 1. REDIRECT CHECK (Most Accurate)
        // If the URL contains queue-it.net, we are 100% in a queue
        if (lowerUrl.includes("queue-it.net") || lowerHtml.includes("queue-it.net")) {
            triggerAlert("QUEUE DETECTED", "Redirected to Queue-it domain.");
            updateStatus("IN QUEUE", "Redirect Detected", "text-neon-red alert-active");
            return;
        }

        // 2. KEYWORD CHECK
        // "Users in line", "Waiting Room", "queue_id"
        if (lowerHtml.includes("users in line") || lowerHtml.includes("waiting room") || lowerHtml.includes("queue_id")) {
             triggerAlert("QUEUE DETECTED", "Queue keywords found in HTML.");
             updateStatus("IN QUEUE", "Keywords Detected", "text-neon-red alert-active");
             return;
        }

        // 3. BLOCK CHECK (Cloudflare/WAF)
        // "Just a moment", "Challenge", "Verify you are human"
        if (lowerHtml.includes("just a moment") || lowerHtml.includes("verify you are human") || lowerHtml.includes("cloudflare")) {
            updateStatus("WAF BLOCKED", "Cloudflare detected proxy. Waiting...", "text-neon-yellow");
            // Do NOT alert on blocks, it's spammy. Just wait.
            return;
        }

        // 4. SUCCESS CHECK
        // We look for specific shop elements that only appear when unlocked
        if (lowerHtml.includes("add to cart") || lowerHtml.includes("trading card game") || lowerHtml.includes("my cart")) {
            triggerAlert("SHOP UNLOCKED!", "Shop navigation is visible and accessible!");
            updateStatus("ACCESSIBLE", "Shop is OPEN.", "text-neon-green alert-active");
            return;
        }

        // 5. AMBIGUOUS
        updateStatus("ONLINE", "Site reachable. No queue detected.", "text-white-glow");
    }

    // --- ALERTS ---

    function triggerAlert(title, message) {
        // Prevent spamming alerts if status hasn't changed? 
        // For now, we alert every time a positive state is found because it's urgent.
        
        playAlarm();

        // Discord
        if (settings.discord) {
            const webhook = document.getElementById('webhookInput').value;
            if (webhook) {
                const color = title.includes("UNLOCKED") ? 5763719 : 15548997; // Green or Red
                fetch(webhook, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        embeds: [{
                            title: `üö® ${title}`,
                            description: message,
                            color: color,
                            timestamp: new Date().toISOString(),
                            footer: { text: "Kronborg Check v3.0" }
                        }]
                    })
                }).catch(e => console.error(e));
            }
        }

        // Email
        if (settings.email) {
            const inputs = document.querySelectorAll('.email-input');
            const emails = Array.from(inputs).map(i => i.value).filter(v => v.includes('@'));
            
            emails.forEach(email => {
                emailjs.send("service_ahqdaj5", "template_whhvnra", {
                    status: title,
                    details: message,
                    timestamp: new Date().toLocaleString(),
                    to_email: email
                });
            });
        }
    }

    // --- SYSTEM CONTROL ---

    function startSystem() {
        const emails = document.querySelectorAll('.email-input');
        const hasEmail = Array.from(emails).some(e => e.value.includes('@'));
        const hasWebhook = document.getElementById('webhookInput').value.length > 10;

        if (!hasEmail && !hasWebhook) {
            alert("Please configure at least one alert method (Email or Discord).");
            return;
        }

        isRunning = true;
        startTime = Date.now();
        document.getElementById('btnStart').classList.add('hidden');
        document.getElementById('btnStop').classList.remove('hidden');
        document.getElementById('stealthIndicator').classList.remove('hidden');
        
        // Start Timer
        timeInterval = setInterval(() => {
            const diff = Date.now() - startTime;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('timer').innerText = `${h}:${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
        }, 1000);

        runLoop();
    }

    function stopSystem() {
        isRunning = false;
        clearTimeout(checkInterval);
        clearInterval(timeInterval);
        document.getElementById('btnStart').classList.remove('hidden');
        document.getElementById('btnStop').classList.add('hidden');
        document.getElementById('stealthIndicator').classList.add('hidden');
        updateStatus("STOPPED", "System Halted", "text-neon-red");
    }

    function runLoop() {
        if (!isRunning) return;

        checkShop();

        // Calculate next run with Jitter (Randomness)
        // Base minutes + Random seconds between 0 and 60
        const baseMs = settings.baseMinutes * 60 * 1000;
        const jitter = Math.floor(Math.random() * 60000); 
        const nextDelay = baseMs + jitter;

        checkInterval = setTimeout(runLoop, nextDelay);
    }

    function updateStatus(main, detail, cssClass) {
        const m = document.getElementById('mainStatus');
        const d = document.getElementById('detailStatus');
        m.innerText = main;
        m.className = `text-2xl font-bold ${cssClass}`;
        d.innerText = detail;
    }

    // Audio
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playAlarm() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(440, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.5);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.5);
    }

    function testAlerts() {
        triggerAlert("TEST FIRED", "This is a test of the Kronborg system.");
        alert("Test sent!");
    }
  </script>
</body>
</html>
