<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QUEUE CHECKER</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap');

    :root {
      --bg-grid: #050510;
      --glass: rgba(10, 20, 30, 0.7);
      --glass-border: rgba(0, 243, 255, 0.2);
      
      --neon-cyan: #00f3ff;
      --neon-magenta: #ff0055;
      --neon-yellow: #ffee00;
      
      --text-main: #e0faff;
      --text-dim: #5a7a8a;
    }

    * { box-sizing: border-box; outline: none; user-select: none; }

    body {
      margin: 0;
      font-family: 'Share Tech Mono', monospace;
      background-color: var(--bg-grid);
      /* TRON GRID BACKGROUND */
      background-image: 
        linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 40px 20px;
    }
    
    /* Horizon Glow */
    body::after {
      content:''; position: fixed; bottom: 0; left: 0; width: 100%; height: 40vh;
      background: linear-gradient(to top, rgba(0, 243, 255, 0.1), transparent);
      z-index: -1; pointer-events: none;
    }

    /* MAIN INTERFACE */
    .interface {
      width: 100%;
      max-width: 800px; /* Wide for logs */
      background: var(--glass);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      box-shadow: 
        0 0 40px rgba(0, 243, 255, 0.1),
        inset 0 0 100px rgba(0,0,0,0.8);
      padding: 2px; /* For inner border effect */
      position: relative;
      clip-path: polygon(
        20px 0, 100% 0, 
        100% calc(100% - 20px), 
        calc(100% - 20px) 100%, 
        0 100%, 
        0 20px
      );
    }
    
    /* Inner Frame */
    .inner-frame {
      background: rgba(0,0,0,0.4);
      padding: 30px;
      height: 100%;
      clip-path: inherit;
    }

    /* HEADER */
    .header {
      display: flex; justify-content: space-between; align-items: flex-end;
      border-bottom: 2px solid var(--glass-border);
      padding-bottom: 15px; margin-bottom: 25px;
    }
    .header h1 {
      font-family: 'Orbitron'; font-size: 32px; margin: 0; letter-spacing: 4px;
      text-transform: uppercase;
      text-shadow: 0 0 10px var(--neon-cyan);
      color: var(--neon-cyan);
    }
    .status-badge {
      font-size: 14px; padding: 5px 10px; border: 1px solid var(--neon-cyan);
      color: var(--neon-cyan); background: rgba(0, 243, 255, 0.1);
      box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
    }

    /* LAYOUT SPLIT */
    .grid-split {
      display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
    }
    @media(max-width: 700px) { .grid-split { grid-template-columns: 1fr; } }

    /* SECTIONS */
    .section-title {
      font-family: 'Orbitron'; color: var(--text-dim); font-size: 12px; letter-spacing: 2px;
      margin-bottom: 10px; display: block; border-left: 3px solid var(--neon-cyan); padding-left: 10px;
    }

    /* LIVE LOG TERMINAL */
    .terminal-window {
      background: #000;
      border: 1px solid #333;
      height: 250px;
      padding: 10px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 12px;
      overflow-y: auto;
      display: flex; flex-direction: column-reverse; /* Newest at bottom visually */
      box-shadow: inset 0 0 20px rgba(0, 243, 255, 0.05);
    }
    .log-line { margin-bottom: 4px; border-bottom: 1px solid #111; padding-bottom: 2px; }
    .log-ts { color: #555; margin-right: 8px; }
    .log-proxy { color: var(--neon-yellow); margin-right: 8px; }
    .c-cyan { color: var(--neon-cyan); }
    .c-pink { color: var(--neon-magenta); }
    .c-dim { color: #666; }

    /* DYNAMIC INPUTS */
    .input-container {
      margin-bottom: 20px;
      max-height: 200px; overflow-y: auto;
    }
    
    .input-row {
      display: flex; gap: 5px; margin-bottom: 5px;
    }
    
    input[type="text"], input[type="email"], input[type="url"] {
      flex: 1;
      background: rgba(0, 243, 255, 0.05);
      border: 1px solid #333;
      color: var(--text-main);
      font-family: 'Share Tech Mono'; font-size: 13px;
      padding: 8px 12px;
      transition: 0.2s;
    }
    input:focus { border-color: var(--neon-cyan); box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); }
    
    .btn-icon {
      width: 35px; background: rgba(255, 0, 85, 0.1); border: 1px solid #555; color: #fff;
      cursor: pointer; transition: 0.2s;
    }
    .btn-icon:hover { border-color: var(--neon-magenta); color: var(--neon-magenta); background: rgba(255, 0, 85, 0.2); }

    .btn-add {
      width: 100%; background: transparent; border: 1px dashed #444; color: #666;
      font-size: 11px; padding: 5px; cursor: pointer; text-transform: uppercase;
    }
    .btn-add:hover { border-color: var(--neon-cyan); color: var(--neon-cyan); }

    /* CONTROLS */
    .control-deck {
      margin-top: 20px; border-top: 1px solid #333; padding-top: 20px;
    }
    
    .slider-group { margin-bottom: 20px; }
    input[type=range] { width: 100%; height: 4px; background: #333; accent-color: var(--neon-cyan); }

    .main-btn {
      width: 100%; padding: 20px;
      font-family: 'Orbitron'; font-size: 18px; letter-spacing: 2px;
      background: var(--neon-cyan); color: #000; border: none; font-weight: 900;
      clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
      cursor: pointer; transition: 0.2s;
    }
    .main-btn:hover { background: #fff; box-shadow: 0 0 30px var(--neon-cyan); }

    .stop-btn { display: none; background: var(--neon-magenta); color: #fff; }
    .stop-btn:hover { background: #ff5588; box-shadow: 0 0 30px var(--neon-magenta); }

    /* SCROLLBARS */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #000; }
    ::-webkit-scrollbar-thumb { background: #333; }
    ::-webkit-scrollbar-thumb:hover { background: var(--neon-cyan); }

  </style>
</head>
<body>

<div class="interface">
  <div class="inner-frame">
    
    <div class="header">
      <h1>QUEUE CHECKER</h1>
      <div id="statusBadge" class="status-badge">SYSTEM OFFLINE</div>
    </div>

    <div class="grid-split">
      
      <div>
        <span class="section-title">LIVE DATA FEED</span>
        <div id="terminal" class="terminal-window">
          <div class="log-line"><span class="c-dim">System initialized. Waiting for input...</span></div>
        </div>
        
        <div style="margin-top: 15px; display: flex; justify-content: space-between; font-size: 12px; color: #666;">
           <span>Target: PokemonCenter TCG</span>
           <span id="timerDisp">Next Scan: --</span>
        </div>
      </div>

      <div>
        
        <span class="section-title">EMAIL RECIPIENTS</span>
        <div id="emailContainer" class="input-container"></div>
        <button class="btn-add" onclick="addEmail()">+ ADD EMAIL</button>

        <span class="section-title" style="margin-top: 15px;">DISCORD WEBHOOKS</span>
        <div id="webhookContainer" class="input-container"></div>
        <button class="btn-add" onclick="addWebhook()">+ ADD WEBHOOK</button>
        <button class="btn-add" style="margin-top:5px; border-color:#333;" onclick="addPreset()">+ LOAD PRESET</button>

      </div>
    </div>

    <div class="control-deck">
      <div class="slider-group">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px; color:var(--neon-cyan);">
           <span>SCAN INTERVAL</span>
           <span id="freqVal">10s</span>
        </div>
        <input type="range" id="freqSlider" min="5" max="60" value="10" oninput="updateFreq(this.value)">
      </div>

      <button id="btnStart" class="main-btn" onclick="toggleSystem(true)">INITIATE SEQUENCE</button>
      <button id="btnStop" class="main-btn stop-btn" onclick="toggleSystem(false)">TERMINATE</button>
      
      <div style="text-align:center; margin-top:10px;">
        <button style="background:none; border:none; color:#444; text-decoration:underline; cursor:pointer;" onclick="test()">[ TEST NOTIFICATION ]</button>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.4.1/dist/email.min.js"></script>
<script>
    // --- CONFIGURATION ---
    const TARGET = "https://www.pokemoncenter.com/category/trading-card-game";
    const EMAIL_KEY = "8w7eu6mrg3lRl6ta3";
    
    // --- STATE ---
    let running = false;
    let timer = null;
    let countdown = null;
    let nextScanTime = 0;

    // --- INIT ---
    if(window.emailjs) emailjs.init({publicKey: EMAIL_KEY});

    window.onload = () => {
        loadData();
        // Ensure at least one empty input exists
        if(document.getElementById('emailContainer').children.length === 0) addEmail();
        if(document.getElementById('webhookContainer').children.length === 0) addWebhook();
    };

    // --- UI FUNCTIONS ---
    function updateFreq(v) { document.getElementById('freqVal').innerText = v + "s"; saveData(); }
    
    function createRow(val, type, ph) {
        const div = document.createElement('div'); div.className = 'input-row';
        div.innerHTML = `
            <input type="${type}" value="${val}" placeholder="${ph}" onchange="saveData()">
            <button class="btn-icon" onclick="this.parentElement.remove();saveData()">Ã—</button>
        `;
        return div;
    }

    function addEmail(v='') { document.getElementById('emailContainer').appendChild(createRow(v, 'email', 'name@email.com')); }
    function addWebhook(v='') { document.getElementById('webhookContainer').appendChild(createRow(v, 'url', 'https://discord...')); }
    function addPreset() { addWebhook("https://discord.com/api/webhooks/1418654823745716436/vuMKu1s095Cq3BfU06OF_Z_mwxG39zHppHJ3c4BX5X38WuJFWPGhIZdopWTEEXlophiN"); saveData(); }

    function log(proxy, msg, styleClass='c-dim') {
        const term = document.getElementById('terminal');
        const line = document.createElement('div'); line.className = 'log-line';
        const ts = new Date().toLocaleTimeString([], {hour12:false});
        line.innerHTML = `<span class="log-ts">${ts}</span><span class="log-proxy">[${proxy}]</span><span class="${styleClass}">${msg}</span>`;
        term.insertBefore(line, term.firstChild);
        // Limit log size
        if(term.children.length > 50) term.lastChild.remove();
    }

    // --- DATA PERSISTENCE ---
    function saveData() {
        const d = {
            ems: Array.from(document.getElementById('emailContainer').querySelectorAll('input')).map(i=>i.value),
            whs: Array.from(document.getElementById('webhookContainer').querySelectorAll('input')).map(i=>i.value),
            frq: document.getElementById('freqSlider').value
        };
        localStorage.setItem('qc_gold', JSON.stringify(d));
    }
    function loadData() {
        const d = JSON.parse(localStorage.getItem('qc_gold'));
        if(!d) return;
        d.ems.forEach(e => addEmail(e));
        d.whs.forEach(w => addWebhook(w));
        document.getElementById('freqSlider').value = d.frq;
        updateFreq(d.frq);
    }

    // --- CORE LOGIC ---
    function toggleSystem(on) {
        running = on;
        const bStart = document.getElementById('btnStart');
        const bStop = document.getElementById('btnStop');
        const badge = document.getElementById('statusBadge');

        if(on) {
            bStart.style.display = 'none'; bStop.style.display = 'block';
            badge.innerText = "SYSTEM ACTIVE";
            badge.style.background = "rgba(0,243,255,0.2)";
            log("SYSTEM", "Sequence started.", "c-cyan");
            loop();
        } else {
            bStart.style.display = 'block'; bStop.style.display = 'none';
            badge.innerText = "SYSTEM OFFLINE";
            badge.style.background = "transparent";
            clearTimeout(timer); clearInterval(countdown);
            log("SYSTEM", "Sequence halted.", "c-pink");
        }
    }

    async function loop() {
        if(!running) return;

        const ts = Date.now();
        const enc = encodeURIComponent(TARGET + `?z=${ts}`);

        // PROXY ROTATION LIST
        const proxies = [
            { name: "AllOrigins", url: `https://api.allorigins.win/raw?url=${enc}` },
            { name: "CorsProxy", url: `https://corsproxy.io/?${enc}` },
            { name: "CodeTabs", url: `https://api.codetabs.com/v1/proxy?quest=${enc}` },
            { name: "ThingProxy", url: `https://thingproxy.freeboard.io/fetch/${enc}` }
        ];

        let success = false;
        let html = "";
        let finalUrl = "";

        // Try Proxies sequentially
        for(const p of proxies) {
            log("NET", `Attempting connection via ${p.name}...`, "c-dim");
            try {
                const ctrl = new AbortController(); 
                const id = setTimeout(() => ctrl.abort(), 10000); // 10s timeout
                
                const res = await fetch(p.url, { signal: ctrl.signal });
                clearTimeout(id);

                if(res.ok) {
                    html = (await res.text()).toLowerCase();
                    finalUrl = res.url;
                    success = true;
                    log(p.name, `Success (200 OK). Size: ${html.length}b`, "c-cyan");
                    break; // Exit loop on success
                } else {
                    log(p.name, `Failed (Status ${res.status})`, "c-pink");
                }
            } catch(e) {
                log(p.name, "Timeout / Error", "c-pink");
            }
        }

        if(!success) {
            log("ERROR", "All proxies failed. Retrying.", "c-pink");
        } else {
            analyze(html, finalUrl);
        }

        // Scheduler
        const freq = parseInt(document.getElementById('freqSlider').value);
        const delay = (freq * 1000) + Math.floor(Math.random() * 5000); // Jitter
        nextScanTime = Date.now() + delay;
        
        // Update Countdown UI
        clearInterval(countdown);
        countdown = setInterval(() => {
            const left = Math.ceil((nextScanTime - Date.now())/1000);
            if(left >= 0) document.getElementById('timerDisp').innerText = `Next Scan: ${left}s`;
        }, 1000);

        timer = setTimeout(loop, delay);
    }

    function analyze(h, u) {
        if (u.includes("queue-it") || h.includes("users in line") || h.includes("queue_id")) {
            log("ALERT", "QUEUE DETECTED!", "c-pink");
            notify("QUEUE DETECTED", "You are in a queue!", "red");
            playSound();
        } 
        else if (h.includes("add to cart") || h.includes("trading card game")) {
            log("STATUS", "Shop Accessible. No Queue.", "c-cyan");
        } 
        else if (h.includes("cloudflare")) {
            log("WAF", "Soft Block (Cloudflare). Skipping.", "c-dim");
        } 
        else {
            log("STATUS", "Site Reachable (Unknown Content).", "c-dim");
        }
    }

    function notify(title, msg, color) {
        const hex = color==='red'?15548997:5763719;
        
        // Discord
        const hooks = Array.from(document.getElementById('webhookContainer').querySelectorAll('input')).map(i=>i.value).filter(v=>v.includes('http'));
        hooks.forEach(h => {
            fetch(h, {
                method:"POST", headers:{"Content-Type":"application/json"},
                body:JSON.stringify({embeds:[{title:`ðŸš¨ ${title}`, description:msg, color:hex}]})
            }).catch(e => log("DISCORD", "Failed to send.", "c-pink"));
        });

        // Email
        const emails = Array.from(document.getElementById('emailContainer').querySelectorAll('input')).map(i=>i.value).filter(v=>v.includes('@'));
        emails.forEach(e => {
            emailjs.send("service_ahqdaj5", "template_whhvnra", {status: title, details: msg, to_email: e});
        });
    }

    function test() { notify("TEST", "System Operational", "green"); log("TEST", "Notification dispatched.", "c-cyan"); playSound(); }

    const ac = new (window.AudioContext || window.webkitAudioContext)();
    function playSound() {
        if(ac.state==='suspended') ac.resume();
        const o=ac.createOscillator(), g=ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type='sawtooth'; o.frequency.value=600; g.gain.value=0.1;
        o.start(); o.stop(ac.currentTime+0.5);
    }
</script>
</body>
</html>
