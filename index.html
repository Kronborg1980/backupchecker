<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KRONBORG TITAN v7.0</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;600;700&display=swap');

    :root {
      --bg-dark: #050505;
      --glass: rgba(15, 15, 25, 0.9);
      --neon-blue: #00f3ff;
      --neon-red: #ff0055;
      --neon-green: #00ff9d;
      --magikarp: #ff5e00;
      --text-main: #e0e0e0;
    }

    * { box-sizing: border-box; outline: none; }

    body {
      margin: 0;
      font-family: 'Rajdhani', sans-serif;
      background-color: var(--bg-dark);
      background-image: 
        radial-gradient(circle at 50% 0%, #1a1a2e 0%, transparent 50%),
        linear-gradient(rgba(0, 243, 255, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.02) 1px, transparent 1px);
      background-size: 100% 100%, 40px 40px, 40px 40px;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 40px 20px; /* Padding ensures scrolling works */
    }

    /* Main Container - WIDER & BIGGER */
    .titan-container {
      width: 100%;
      max-width: 650px; /* Much wider */
      background: var(--glass);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      backdrop-filter: blur(25px);
      box-shadow: 
        0 0 60px rgba(0, 243, 255, 0.15),
        inset 0 0 30px rgba(0, 0, 0, 0.8);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      padding: 30px;
      background: linear-gradient(180deg, rgba(0,243,255,0.05), transparent);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 28px; /* Bigger Title */
      margin: 0;
      color: #fff;
      text-shadow: 0 0 10px var(--neon-blue);
      letter-spacing: 3px;
    }

    .cubone-guard {
      width: 64px; height: 64px; /* Bigger Icon */
      background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/104.png');
      background-size: cover;
      filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
    }

    /* Radar Area */
    .radar-zone {
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .radar-ring {
      width: 140px; height: 140px;
      border: 3px dashed rgba(255,255,255,0.1);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: 0.3s;
      margin-bottom: 15px;
    }

    .radar-ring.scanning {
      border-color: var(--neon-blue);
      box-shadow: 0 0 40px rgba(0, 243, 255, 0.2);
      animation: rotateRing 3s linear infinite;
    }

    @keyframes rotateRing { 100% { transform: rotate(360deg); } }

    .magikarp {
      width: 96px; height: 96px;
      background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png');
      background-size: cover;
      image-rendering: pixelated;
    }
    
    .radar-ring.scanning .magikarp { animation: flop 0.4s infinite alternate; }
    @keyframes flop { 0% { transform: rotate(-10deg); } 100% { transform: rotate(10deg); } }

    .status-text { font-family: 'Orbitron'; font-size: 18px; color: #888; letter-spacing: 1px; }
    .status-timer { font-family: monospace; font-size: 14px; color: var(--neon-blue); margin-top: 5px; opacity: 0; }
    .status-timer.visible { opacity: 1; }

    /* Content Area */
    .content-body { padding: 30px; }

    /* Settings Panels */
    .control-panel {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .panel-head {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 15px;
    }
    .panel-title { font-size: 16px; font-weight: 700; color: #fff; display: flex; align-items: center; gap: 10px; }

    /* Big Inputs */
    .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
    
    input[type="text"] {
      flex: 1;
      padding: 12px 15px; /* Bigger click area */
      font-size: 16px;
      background: #000;
      border: 1px solid #333;
      border-radius: 8px;
      color: var(--neon-blue);
      font-family: 'Rajdhani', sans-serif;
    }
    input:focus { border-color: var(--neon-blue); }

    button { cursor: pointer; transition: 0.2s; font-family: 'Rajdhani', sans-serif; }

    .btn-del {
      width: 45px; background: #111; border: 1px solid #333; color: #666; font-size: 20px; border-radius: 8px;
    }
    .btn-del:hover { border-color: var(--neon-red); color: var(--neon-red); }

    .btn-add {
      background: transparent; border: 1px dashed #444; color: #888;
      width: 100%; padding: 10px; border-radius: 8px; font-weight: 600;
      margin-top: 5px;
    }
    .btn-add:hover { border-color: var(--neon-blue); color: var(--neon-blue); }

    /* Toggle Switch (Bigger) */
    .toggle {
      width: 50px; height: 26px; background: #333; border-radius: 13px;
      position: relative; cursor: pointer;
    }
    .toggle::after {
      content:''; position: absolute; top: 3px; left: 3px;
      width: 20px; height: 20px; background: #fff; border-radius: 50%; transition: 0.3s;
    }
    input:checked + .toggle { background: var(--neon-green); }
    input:checked + .toggle::after { transform: translateX(24px); }

    /* Range Slider */
    input[type=range] { width: 100%; height: 6px; background: #333; border-radius: 3px; accent-color: var(--neon-blue); margin-top: 10px; }

    /* Start/Stop Buttons */
    .action-btn {
      width: 100%;
      padding: 20px;
      font-size: 20px;
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      letter-spacing: 2px;
      border: none;
      border-radius: 12px;
      margin-top: 10px;
      text-transform: uppercase;
    }
    
    .start { background: var(--neon-blue); color: #000; box-shadow: 0 0 25px rgba(0, 243, 255, 0.3); }
    .start:hover { transform: translateY(-2px); box-shadow: 0 0 40px rgba(0, 243, 255, 0.5); }
    
    .stop { background: var(--neon-red); color: #fff; display: none; box-shadow: 0 0 25px rgba(255, 0, 85, 0.3); }
    .stop:hover { background: #ff3366; }

    /* THE DETECTIVE LOG */
    .log-container {
      background: #080808;
      border: 1px solid #333;
      border-radius: 12px;
      height: 200px; /* Taller log */
      padding: 15px;
      overflow-y: auto;
      margin-top: 25px;
      font-family: 'Courier New', monospace;
      font-size: 13px; /* Readable text */
      display: flex;
      flex-direction: column-reverse; /* New items at bottom physically, looks like top */
    }
    
    .log-row { margin-bottom: 6px; border-bottom: 1px solid #111; padding-bottom: 4px; }
    .log-time { color: #555; margin-right: 10px; }
    .msg-info { color: #aaa; }
    .msg-success { color: var(--neon-green); }
    .msg-err { color: var(--neon-red); }
    .msg-detail { color: #666; font-style: italic; margin-left: 5px; }

    .hidden { display: none; }

  </style>
</head>
<body>

  <div class="titan-container">
    
    <div class="header">
      <div>
        <h1>KRONBORG</h1>
        <div style="font-size: 12px; color: #888; letter-spacing: 2px;">PROJECT TITAN v7.0</div>
      </div>
      <div class="cubone-guard" title="System Guardian"></div>
    </div>

    <div class="radar-zone">
      <div class="radar-ring" id="radar">
        <div class="magikarp"></div>
      </div>
      <div class="status-text" id="statusText">SYSTEM OFFLINE</div>
      <div class="status-timer" id="timer">RUN TIME: 00:00:00</div>
    </div>

    <div class="content-body">

      <div class="control-panel">
        <div class="panel-head">
          <div class="panel-title">üìß Email Alerts</div>
          <label>
            <input type="checkbox" id="checkEmail" checked class="hidden" onchange="save()">
            <div class="toggle"></div>
          </label>
        </div>
        <div id="emailList"></div>
        <button class="btn-add" onclick="addEmail()">+ ADD EMAIL RECIPIENT</button>
      </div>

      <div class="control-panel">
        <div class="panel-head">
          <div class="panel-title">üëæ Discord Webhooks</div>
          <label>
            <input type="checkbox" id="checkDiscord" checked class="hidden" onchange="save()">
            <div class="toggle"></div>
          </label>
        </div>
        <div id="discordList"></div>
        <button class="btn-add" onclick="addDiscord()">+ ADD WEBHOOK URL</button>
        <button class="btn-add" style="border-style: solid; border-color: #333; color: var(--neon-blue); margin-top: 10px;" onclick="loadPokezonan()">‚ö° LOAD "POKEZONAN" PRESET</button>
      </div>

      <div class="control-panel">
        <div class="panel-head">
          <div class="panel-title">‚è±Ô∏è Check Interval</div>
          <div style="color: var(--neon-blue); font-size: 18px; font-weight: bold;" id="freqVal">10m</div>
        </div>
        <input type="range" id="freqSlider" min="1" max="60" value="10" oninput="updateFreq(this.value)">
        <div style="margin-top: 5px; color: #666; font-size: 14px;">Includes stealth "Jitter" (¬±60s random delay)</div>
      </div>

      <button id="btnStart" class="action-btn start" onclick="toggleSystem(true)">START MONITORING</button>
      <button id="btnStop" class="action-btn stop" onclick="toggleSystem(false)">STOP SYSTEM</button>

      <div class="log-container" id="logWindow">
        <div class="log-row">
          <span class="log-time">--:--:--</span>
          <span class="msg-info">System initialized. Ready to start.</span>
        </div>
      </div>

      <div style="text-align: center; margin-top: 20px;">
        <button style="background:none; border:none; color:#444; text-decoration: underline;" onclick="testAlerts()">Test Notification System</button>
      </div>

    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.4.1/dist/email.min.js"></script>
<script>
    // --- SETUP ---
    const TARGET = "https://www.pokemoncenter.com/category/trading-card-game";
    const EMAIL_KEY = "8w7eu6mrg3lRl6ta3";
    
    let isRunning = false;
    let scanTimeout = null;
    let clockInterval = null;
    let startTime = 0;

    // Init EmailJS
    if(window.emailjs) emailjs.init({ publicKey: EMAIL_KEY });

    // --- LOAD SAVED DATA ---
    window.onload = () => {
        loadData();
        if(document.getElementById('emailList').children.length === 0) addEmail();
        if(document.getElementById('discordList').children.length === 0) addDiscord();
    }

    // --- UI FUNCTIONS ---
    function updateFreq(val) {
        document.getElementById('freqVal').innerText = val + "m";
        save();
    }

    function createInput(val, ph, type) {
        const div = document.createElement('div');
        div.className = 'input-group';
        div.innerHTML = `
            <input type="${type}" value="${val}" placeholder="${ph}" onchange="save()">
            <button class="btn-del" onclick="this.parentElement.remove(); save()">√ó</button>
        `;
        return div;
    }

    function addEmail(val='') {
        document.getElementById('emailList').appendChild(createInput(val, 'name@example.com', 'email'));
    }

    function addDiscord(val='') {
        document.getElementById('discordList').appendChild(createInput(val, 'https://discord.com/api/webhooks/...', 'url'));
    }

    function loadPokezonan() {
        addDiscord("https://discord.com/api/webhooks/1418654823745716436/vuMKu1s095Cq3BfU06OF_Z_mwxG39zHppHJ3c4BX5X38WuJFWPGhIZdopWTEEXlophiN");
        save();
        log("System", "Loaded 'Pokezonan' webhook preset.", "msg-success");
    }

    // --- LOGGING ---
    function log(category, msg, styleClass='msg-info') {
        const win = document.getElementById('logWindow');
        const time = new Date().toLocaleTimeString();
        
        const row = document.createElement('div');
        row.className = 'log-row';
        row.innerHTML = `
            <span class="log-time">${time}</span>
            <strong style="color:#666">[${category}]</strong>
            <span class="${styleClass}">${msg}</span>
        `;
        
        win.insertBefore(row, win.firstChild);
        // Keep memory low
        if(win.children.length > 50) win.lastChild.remove();
    }

    // --- STORAGE ---
    function save() {
        const data = {
            emails: Array.from(document.getElementById('emailList').querySelectorAll('input')).map(i=>i.value),
            hooks: Array.from(document.getElementById('discordList').querySelectorAll('input')).map(i=>i.value),
            emailOn: document.getElementById('checkEmail').checked,
            discordOn: document.getElementById('checkDiscord').checked,
            freq: document.getElementById('freqSlider').value
        };
        localStorage.setItem('kronborg_v7', JSON.stringify(data));
    }

    function loadData() {
        const data = JSON.parse(localStorage.getItem('kronborg_v7'));
        if(!data) return;
        
        data.emails.forEach(e => addEmail(e));
        data.hooks.forEach(h => addDiscord(h));
        document.getElementById('checkEmail').checked = data.emailOn;
        document.getElementById('checkDiscord').checked = data.discordOn;
        document.getElementById('freqSlider').value = data.freq;
        updateFreq(data.freq);
    }

    // --- CORE LOGIC ---
    function toggleSystem(on) {
        isRunning = on;
        const btnStart = document.getElementById('btnStart');
        const btnStop = document.getElementById('btnStop');
        const radar = document.getElementById('radar');
        const status = document.getElementById('statusText');
        const timer = document.getElementById('timer');

        if(on) {
            btnStart.style.display = 'none';
            btnStop.style.display = 'block';
            radar.classList.add('scanning');
            status.innerText = "SEARCHING FOR QUEUE...";
            status.style.color = "var(--neon-blue)";
            timer.classList.add('visible');
            
            startTime = Date.now();
            clockInterval = setInterval(() => {
                const d = new Date(Date.now() - startTime);
                timer.innerText = "RUN TIME: " + d.toISOString().substr(11, 8);
            }, 1000);

            log("System", "Monitoring started. Stealth Mode Active.", "msg-success");
            runCheck();
        } else {
            btnStart.style.display = 'block';
            btnStop.style.display = 'none';
            radar.classList.remove('scanning');
            status.innerText = "SYSTEM OFFLINE";
            status.style.color = "#888";
            timer.classList.remove('visible');
            
            clearTimeout(scanTimeout);
            clearInterval(clockInterval);
            log("System", "Monitoring stopped by user.", "msg-err");
        }
    }

    async function runCheck() {
        if(!isRunning) return;

        log("Scanner", "Connecting via Proxy Mesh...", "msg-info");

        const ts = Date.now();
        const enc = encodeURIComponent(TARGET + `?t=${ts}`);
        // Rotation to prevent blocking
        const proxies = [
            `https://api.allorigins.win/raw?url=${enc}`,
            `https://corsproxy.io/?${enc}`
        ];

        let content = "";
        let finalUrl = "";
        
        // Fetch Logic
        for(const p of proxies) {
            try {
                const c = new AbortController();
                setTimeout(()=>c.abort(), 15000); // 15s timeout
                const res = await fetch(p, {signal: c.signal});
                if(res.ok) {
                    content = (await res.text()).toLowerCase();
                    finalUrl = res.url;
                    break;
                }
            } catch(e) {
                // Silent fail to next proxy
            }
        }

        // Analysis
        if(!content) {
            log("Error", "Network unreachable. All proxies failed.", "msg-err");
        } else {
            analyze(content, finalUrl);
        }

        // Schedule Next
        const mins = parseInt(document.getElementById('freqSlider').value);
        const jitter = Math.floor(Math.random() * 60000); // 0-60s random
        const nextMs = (mins * 60000) + jitter;
        
        log("Scheduler", `Next scan in ${Math.floor(nextMs/1000)} seconds.`, "msg-detail");
        scanTimeout = setTimeout(runCheck, nextMs);
    }

    function analyze(html, url) {
        // 1. Check for Queue
        if (url.includes("queue-it") || html.includes("users in line") || html.includes("queue_id")) {
            log("ALERT", "QUEUE DETECTED! Redirect found.", "msg-err");
            sendNotify("QUEUE DETECTED", "You are in a queue! Check immediately.", "red");
            playAlarm();
        }
        // 2. Check for Soft Block
        else if (html.includes("cloudflare") || html.includes("challenge") || html.includes("just a moment")) {
            log("WAF", "Soft-Block (Cloudflare). Retrying next cycle.", "msg-detail");
        }
        // 3. Check for Success
        else if (html.includes("add to cart") || html.includes("trading card game")) {
            log("Status", "Shop Accessible. 'Add to Cart' found.", "msg-success");
            // Optional: Alert on Drop (uncomment if you want alerts when shop is just open)
            // sendNotify("SHOP OPEN", "Site is accessible.", "green");
        }
        // 4. Default / No Queue
        else {
            log("Analysis", "Site reachable. No queue keywords found.", "msg-info");
        }
    }

    function sendNotify(title, msg, color) {
        const useEmail = document.getElementById('checkEmail').checked;
        const useDiscord = document.getElementById('checkDiscord').checked;
        
        if(useDiscord) {
            const hooks = Array.from(document.getElementById('discordList').querySelectorAll('input')).map(i=>i.value).filter(v=>v.includes('http'));
            const hexColor = color === 'red' ? 15548997 : 5763719;
            hooks.forEach(h => {
                fetch(h, {
                    method:"POST", headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({embeds:[{title:`üö® ${title}`, description:msg, color:hexColor}]})
                }).catch(e=>console.log(e));
            });
        }

        if(useEmail) {
            const emails = Array.from(document.getElementById('emailList').querySelectorAll('input')).map(i=>i.value).filter(v=>v.includes('@'));
            emails.forEach(e => {
                emailjs.send("service_ahqdaj5", "template_whhvnra", {status: title, details: msg, to_email: e});
            });
        }
    }

    function testAlerts() {
        sendNotify("TEST ALERT", "Magikarp Protocol Operational.", "green");
        log("Test", "Test notifications dispatched.", "msg-success");
        playAlarm();
    }

    const ac = new (window.AudioContext || window.webkitAudioContext)();
    function playAlarm() {
        if(ac.state==='suspended') ac.resume();
        const o = ac.createOscillator(); const g = ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type='square'; o.frequency.value=600;
        g.gain.value=0.1; 
        o.start(); o.stop(ac.currentTime+0.2);
    }
</script>
</body>
</html>
