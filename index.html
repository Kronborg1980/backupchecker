<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KRONBORG: DEEP SPACE v12</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;600;900&family=JetBrains+Mono:wght@400;700&display=swap');

    :root {
      --bg-deep: #020204;
      --glass: rgba(255, 255, 255, 0.05);
      --border: rgba(255, 255, 255, 0.1);
      
      --color-safe: #00ffa3;  /* Green/Teal */
      --color-warn: #ffcc00;  /* Gold */
      --color-alert: #ff0055; /* Hot Pink/Red */
      --color-idle: #444455;
    }

    * { box-sizing: border-box; user-select: none; outline: none; }

    body {
      margin: 0;
      font-family: 'Exo 2', sans-serif;
      background-color: var(--bg-deep);
      /* Deep Space Starfield */
      background-image: 
        radial-gradient(1px 1px at 10% 10%, #fff, transparent),
        radial-gradient(1px 1px at 20% 20%, #fff, transparent),
        radial-gradient(2px 2px at 50% 50%, #555, transparent),
        radial-gradient(circle at 50% -20%, #1a1a2e 0%, #000 70%);
      background-size: 500px 500px, 400px 400px, 300px 300px, 100% 100%;
      color: #fff;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    /* THE MONOLITH CONTAINER */
    .sentry-unit {
      width: 100%;
      max-width: 500px;
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 24px;
      box-shadow: 0 0 80px rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* TOP STATUS BAR */
    .status-header {
      padding: 25px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .brand h1 {
      margin: 0; font-weight: 900; font-size: 24px; letter-spacing: 2px;
      background: linear-gradient(90deg, #fff, #888);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .brand span { font-size: 10px; color: #666; letter-spacing: 2px; text-transform: uppercase; }

    .mascot-area { display: flex; gap: 10px; }
    .icon-box {
      width: 40px; height: 40px; border-radius: 50%;
      background: rgba(0,0,0,0.3); border: 1px solid var(--border);
      display: flex; justify-content: center; align-items: center;
    }
    .poke-icon { width: 30px; height: 30px; background-size: cover; image-rendering: pixelated; }

    /* MAIN DISPLAY - DESIGNED FOR DISTANCE VIEWING */
    .main-display {
      padding: 40px 20px;
      text-align: center;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.02) 0%, transparent 70%);
    }

    .radar-ring {
      width: 140px; height: 140px;
      margin: 0 auto 20px;
      border-radius: 50%;
      border: 4px solid #333;
      display: flex; justify-content: center; align-items: center;
      position: relative; transition: 0.3s;
    }
    
    /* Radar States */
    .radar-ring.scanning { border-color: var(--color-warn); box-shadow: 0 0 30px rgba(255, 204, 0, 0.2); }
    .radar-ring.safe { border-color: var(--color-safe); box-shadow: 0 0 50px rgba(0, 255, 163, 0.3); }
    .radar-ring.danger { border-color: var(--color-alert); box-shadow: 0 0 60px rgba(255, 0, 85, 0.4); animation: pulseRed 1s infinite; }

    @keyframes pulseRed { 0% { box-shadow: 0 0 20px var(--color-alert); } 100% { box-shadow: 0 0 60px var(--color-alert); } }

    .big-karp {
      width: 100px; height: 100px;
      background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png');
      background-size: cover;
      transition: 0.5s;
    }
    .radar-ring.scanning .big-karp { animation: float 3s ease-in-out infinite; opacity: 0.7; }
    .radar-ring.safe .big-karp { transform: scale(1.2) rotate(-10deg); filter: drop-shadow(0 0 10px var(--color-safe)); opacity: 1; }
    
    @keyframes float { 0% { transform: translateY(0); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0); } }

    /* HUGE STATUS TEXT */
    .status-text {
      font-family: 'Exo 2', sans-serif;
      font-weight: 900;
      font-size: 32px;
      letter-spacing: 2px;
      color: #555;
      text-transform: uppercase;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
      margin-bottom: 5px;
    }
    .sub-status { font-family: 'JetBrains Mono'; font-size: 12px; color: #888; }
    .countdown { color: var(--color-warn); font-weight: bold; }

    /* CONTROL DECK */
    .controls { padding: 25px; background: rgba(0,0,0,0.2); }

    /* Input Rows */
    .config-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 15px; padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }
    .config-label { font-size: 14px; font-weight: 600; color: #ccc; }
    
    .hidden-panel {
        max-height: 0; overflow: hidden; transition: 0.3s;
        background: rgba(0,0,0,0.3); border-radius: 8px;
    }
    .hidden-panel.open { max-height: 200px; overflow-y: auto; padding: 10px; margin-bottom: 15px; }

    /* Inputs */
    .input-line { display: flex; gap: 5px; margin-bottom: 5px; }
    input[type="text"], input[type="email"], input[type="url"] {
      width: 100%; background: rgba(255,255,255,0.1); border: none;
      padding: 8px; border-radius: 4px; color: #fff; font-family: 'JetBrains Mono'; font-size: 12px;
    }
    .btn-small { background: #333; border: none; color: #fff; border-radius: 4px; cursor: pointer; }
    .btn-small:hover { background: var(--color-alert); }

    .edit-btn { background: none; border: none; color: #666; font-size: 11px; cursor: pointer; text-decoration: underline; }
    .edit-btn:hover { color: #fff; }

    /* Slider */
    input[type=range] { width: 100%; height: 4px; background: #444; border-radius: 2px; accent-color: var(--color-warn); }

    /* Big Toggle Switch */
    .switch {
      position: relative; display: inline-block; width: 44px; height: 24px;
    }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background-color: #333; transition: .4s; border-radius: 34px;
    }
    .slider:before {
      position: absolute; content: ""; height: 16px; width: 16px;
      left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%;
    }
    input:checked + .slider { background-color: var(--color-safe); }
    input:checked + .slider:before { transform: translateX(20px); }

    /* POWER BUTTON */
    .power-btn {
      width: 100%; padding: 20px;
      background: #fff; color: #000;
      border: none; border-radius: 12px;
      font-family: 'Exo 2'; font-weight: 900; font-size: 16px; letter-spacing: 1px;
      cursor: pointer; transition: 0.2s;
      box-shadow: 0 0 20px rgba(255,255,255,0.2);
    }
    .power-btn:hover { transform: translateY(-2px); box-shadow: 0 0 40px rgba(255,255,255,0.4); }
    
    .power-btn.active { background: var(--color-alert); color: #fff; box-shadow: 0 0 30px var(--color-alert); }

  </style>
</head>
<body>

  <div class="sentry-unit">
    
    <div class="status-header">
      <div class="brand">
        <h1>KRONBORG</h1>
        <span>DEEP SPACE SENTRY</span>
      </div>
      <div class="mascot-area">
        <div class="icon-box"><div class="poke-icon" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/104.png')"></div></div>
        <div class="icon-box"><div class="poke-icon" style="background-image: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/129.png')"></div></div>
      </div>
    </div>

    <div class="main-display">
      <div class="radar-ring" id="radar">
        <div class="big-karp"></div>
      </div>
      <div class="status-text" id="mainStatus">SYSTEM IDLE</div>
      <div class="sub-status" id="subStatus">Ready to engage proxy mesh.</div>
    </div>

    <div class="controls">
      
      <div class="config-row">
        <div>
          <div class="config-label">SCAN INTERVAL</div>
          <div style="font-size:11px; color:#666;">Frequency: <span id="freqLabel" style="color:#fff">60s</span></div>
        </div>
        <div style="width: 50%;">
           <input type="range" id="freqSlider" min="30" max="300" value="60" oninput="updateFreq(this.value)">
        </div>
      </div>

      <div class="config-row" style="border:none; padding-bottom:0;">
        <div class="config-label">NOTIFICATIONS</div>
        <div style="display:flex; gap:15px;">
          <div style="text-align:center;">
             <span style="font-size:10px; color:#888; display:block; margin-bottom:5px;">EMAIL</span>
             <label class="switch"><input type="checkbox" id="emailToggle" checked onchange="save()"><span class="slider"></span></label>
             <button class="edit-btn" onclick="togglePanel('emailPanel')">Edit</button>
          </div>
          <div style="text-align:center;">
             <span style="font-size:10px; color:#888; display:block; margin-bottom:5px;">DISCORD</span>
             <label class="switch"><input type="checkbox" id="discordToggle" checked onchange="save()"><span class="slider"></span></label>
             <button class="edit-btn" onclick="togglePanel('discordPanel')">Edit</button>
          </div>
        </div>
      </div>

      <div class="hidden-panel" id="emailPanel">
        <div id="emailList"></div>
        <button class="edit-btn" style="width:100%; text-align:center; padding:5px;" onclick="addEmail()">+ Add Recipient</button>
      </div>

      <div class="hidden-panel" id="discordPanel">
        <div id="discordList"></div>
        <div style="display:flex; justify-content:space-between; padding:0 5px;">
           <button class="edit-btn" onclick="addDiscord()">+ Add Webhook</button>
           <button class="edit-btn" style="color:var(--color-warn)" onclick="addPreset()">Load Preset</button>
        </div>
      </div>

      <button id="btnPower" class="power-btn" onclick="togglePower()">INITIATE SCAN</button>
      
      <div style="text-align:center; margin-top:15px;">
        <button class="edit-btn" onclick="testAlerts()">[ Send Test Notification ]</button>
      </div>

    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4.4.1/dist/email.min.js"></script>
<script>
    // CONFIGURATION
    const TARGET = "https://www.pokemoncenter.com/category/trading-card-game";
    const KEY = "8w7eu6mrg3lRl6ta3";
    
    // STATE
    let running = false;
    let timer = null;
    let countdownInterval = null;
    let nextScanTime = 0;

    // INIT
    if(window.emailjs) emailjs.init({publicKey: KEY});

    window.onload = () => {
        loadSettings();
        if(document.getElementById('emailList').children.length === 0) addEmail();
        if(document.getElementById('discordList').children.length === 0) addDiscord();
    }

    // --- UI HELPERS ---
    function updateFreq(val) {
        document.getElementById('freqLabel').innerText = val + "s";
        save();
    }
    
    function togglePanel(id) {
        document.getElementById(id).classList.toggle('open');
    }

    function createInput(val, type, place) {
        const div = document.createElement('div'); div.className = 'input-line';
        div.innerHTML = `<input type="${type}" value="${val}" placeholder="${place}" onchange="save()"><button class="btn-small" onclick="this.parentElement.remove();save()">Ã—</button>`;
        return div;
    }

    function addEmail(val='') { document.getElementById('emailList').appendChild(createInput(val, 'email', 'name@email.com')); }
    function addDiscord(val='') { document.getElementById('discordList').appendChild(createInput(val, 'url', 'https://discord...')); }
    function addPreset() { addDiscord("https://discord.com/api/webhooks/1418654823745716436/vuMKu1s095Cq3BfU06OF_Z_mwxG39zHppHJ3c4BX5X38WuJFWPGhIZdopWTEEXlophiN"); save(); }

    function setStatus(main, sub, color, ringClass) {
        const m = document.getElementById('mainStatus');
        m.innerText = main;
        m.style.color = color;
        m.style.textShadow = `0 0 20px ${color}`;
        document.getElementById('subStatus').innerHTML = sub;
        document.getElementById('radar').className = `radar-ring ${ringClass}`;
    }

    // --- STORAGE ---
    function save() {
        const data = {
            ems: Array.from(document.getElementById('emailList').querySelectorAll('input')).map(i=>i.value),
            whs: Array.from(document.getElementById('discordList').querySelectorAll('input')).map(i=>i.value),
            eOn: document.getElementById('emailToggle').checked,
            dOn: document.getElementById('discordToggle').checked,
            frq: document.getElementById('freqSlider').value
        };
        localStorage.setItem('k12_sentry', JSON.stringify(data));
    }

    function loadSettings() {
        const d = JSON.parse(localStorage.getItem('k12_sentry'));
        if(!d) return;
        d.ems.forEach(e => addEmail(e));
        d.whs.forEach(w => addDiscord(w));
        document.getElementById('emailToggle').checked = d.eOn;
        document.getElementById('discordToggle').checked = d.dOn;
        document.getElementById('freqSlider').value = d.frq;
        updateFreq(d.frq);
    }

    // --- LOGIC ---
    function togglePower() {
        running = !running;
        const btn = document.getElementById('btnPower');
        
        if(running) {
            btn.innerText = "TERMINATE SCAN";
            btn.classList.add('active');
            setStatus("SCANNING", "Initializing proxy rotation...", "#fff", "scanning");
            loop();
        } else {
            btn.innerText = "INITIATE SCAN";
            btn.classList.remove('active');
            setStatus("SYSTEM IDLE", "Monitoring halted.", "#555", "");
            clearTimeout(timer);
            clearInterval(countdownInterval);
        }
    }

    async function loop() {
        if(!running) return;

        // 1. Prepare
        const ts = Date.now();
        const enc = encodeURIComponent(TARGET + `?z=${ts}`);
        
        // PROXY MESH (Redundant/Failover)
        const proxies = [
            `https://api.allorigins.win/raw?url=${enc}`,
            `https://corsproxy.io/?${enc}`, 
            `https://api.codetabs.com/v1/proxy?quest=${enc}`
        ];

        let html = null;
        let finalUrl = "";
        
        // 2. Fetch (Failover Logic)
        for(const p of proxies) {
            try {
                const c = new AbortController(); setTimeout(()=>c.abort(), 10000);
                const r = await fetch(p, {signal:c.signal});
                if(r.ok) {
                    html = (await r.text()).toLowerCase();
                    finalUrl = r.url;
                    break; // Success, stop trying proxies
                }
            } catch(e) { /* silent fail to next proxy */ }
        }

        // 3. Analyze
        if(!html) {
            setStatus("NET ERROR", "All proxies timed out. Retrying.", "var(--color-alert)", "danger");
        } 
        else if (finalUrl.includes("queue-it") || html.includes("users in line")) {
            setStatus("QUEUE FOUND", "Redirect detected!", "var(--color-alert)", "danger");
            notify("QUEUE ACTIVE", "You are in a queue!", "red");
            alarm();
        }
        else if (html.includes("add to cart") || html.includes("trading card game")) {
            setStatus("NO QUEUE", "Shop accessible. 200 OK.", "var(--color-safe)", "safe");
        }
        else if (html.includes("cloudflare") || html.includes("just a moment")) {
            setStatus("WAF WAIT", "Soft Block (Cloudflare). Retrying.", "#fff", "scanning");
        }
        else {
            setStatus("NO QUEUE", "Site reachable. No keywords.", "var(--color-safe)", "safe");
        }

        // 4. Schedule (With Countdown UI)
        const seconds = parseInt(document.getElementById('freqSlider').value);
        nextScanTime = Date.now() + (seconds * 1000);
        
        clearInterval(countdownInterval);
        countdownInterval = setInterval(() => {
            const left = Math.ceil((nextScanTime - Date.now())/1000);
            if(left >= 0 && running) {
                 document.getElementById('subStatus').innerHTML = `Next check in: <span class="countdown">${left}s</span>`;
            }
        }, 1000);

        timer = setTimeout(loop, seconds * 1000);
    }

    function notify(title, msg, color) {
        if(document.getElementById('discordToggle').checked) {
            const hex = color==='red'?15548997:5763719;
            const hooks = Array.from(document.getElementById('discordList').querySelectorAll('input')).map(i=>i.value).filter(v=>v.includes('http'));
            hooks.forEach(h => fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embeds:[{title:`ðŸš¨ ${title}`,description:msg,color:hex}]})}).catch(()=>{}));
        }
        if(document.getElementById('emailToggle').checked) {
            const mails = Array.from(document.getElementById('emailList').querySelectorAll('input')).map(i=>i.value).filter(v=>v.includes('@'));
            mails.forEach(e => emailjs.send("service_ahqdaj5","template_whhvnra",{status:title,details:msg,to_email:e}));
        }
    }

    function testAlerts() {
        notify("TEST ALERT", "System is operational.", "green");
        setStatus("TEST SENT", "Check your devices.", "var(--color-warn)", "safe");
        setTimeout(() => setStatus("SYSTEM IDLE", "Monitoring halted.", "#555", ""), 2000);
        alarm();
    }

    const ac = new (window.AudioContext || window.webkitAudioContext)();
    function alarm() {
        if(ac.state==='suspended') ac.resume();
        const o=ac.createOscillator(); const g=ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type='sawtooth'; o.frequency.value=600; g.gain.value=0.1;
        o.start(); o.stop(ac.currentTime+0.5);
    }

</script>
</body>
</html>
